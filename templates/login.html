{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card shadow-lg border-0 text-center">
                <div class="card-header bg-white pt-4 border-0">
                    <h3 class="fw-bold text-dark">Welcome Back</h3>
                    <p class="text-muted">Login to track your recycling rewards</p>
                </div>
                <div class="card-body p-5">
                    
                    <div id="alertBox" class="alert d-none"></div>

                    <button id="googleBtn" class="btn btn-light border shadow-sm w-100 py-3 mb-3 d-flex align-items-center justify-content-center gap-3">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="24" height="24" alt="Google">
                        <span class="fs-5 fw-bold">Sign in with Google</span>
                    </button>

                    <form id="flaskAuthForm" action="/login" method="POST" style="display:none;">
                        <input type="hidden" name="email" id="flaskEmail">
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script>
    // --- YOUR REAL CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyChYVXkvYgTchL1JK3Z_ESo1ucsbojGOVI",
        authDomain: "rvm-rewards.firebaseapp.com",
        projectId: "rvm-rewards",
        storageBucket: "rvm-rewards.firebasestorage.app",
        messagingSenderId: "586613270766",
        appId: "1:586613270766:web:241393dd194c33dd02ebff",
        measurementId: "G-3Q3XKX0F1D"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    document.getElementById("googleBtn").addEventListener("click", async () => {
        const btn = document.getElementById("googleBtn");
        const alertBox = document.getElementById("alertBox");

        try {
            // 1. Open Google Popup
            const result = await auth.signInWithPopup(provider);
            const user = result.user;

            console.log("Logged in as:", user.email);

            // 2. Send Email to Flask Backend
            document.getElementById("flaskEmail").value = user.email;
            document.getElementById("flaskAuthForm").submit();

        } catch (error) {
            console.error(error);
            alertBox.className = "alert alert-danger";
            alertBox.innerText = "Login Failed: " + error.message;
            alertBox.classList.remove("d-none");
        }
    });
</script>
{% endblock %}